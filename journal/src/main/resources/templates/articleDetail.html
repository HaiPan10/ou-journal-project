<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
    layout:decorate="~{layouts/adminLayout}">

<section layout:fragment="content">
    <div>Tiêu đề: <span th:text="${article.title}"></span></div>
    <div>Abstract: <span th:text="${article.abstracts}"></span></div>
    <div>Từ khóa: <span th:text="${article.keywords}"></span></div>
    <div>Nội dung: </div>
    <div id="acceptBtn" style="color: green; cursor:pointer">Đồng ý</div>
    <div id="rejectBtn" style="color: red; cursor: pointer;">Từ chối</div>
    <div>Tổng số reviewer: <input id="totalReviewer" type="number" value="1" min="1" max="10"></div>
    <textarea id="commentArticle" maxlength="255" cols="60" rows="5" placeholder="Nhận xét"></textarea>
    <div>
        <iframe th:src="${viewUrl}" style="width: 100%; height: 1000px; background-color: white;"></iframe>
    </div>
    <script th:inline="javascript">
        var acceptBtn = document.getElementById('acceptBtn')
        var rejectBtn = document.getElementById('rejectBtn')
        var commentArticle = document.getElementById('commentArticle')
        acceptBtn.addEventListener('click', (e) => {
            callUpdateApi('accept')
        })

        rejectBtn.addEventListener('click', (e) => {
            callUpdateApi('reject')
        })

        function callUpdateApi(status) {
            var requestBody = {
                articleNote: {
                    note: commentArticle.value
                }
            }
            if (status === 'accept') {
                requestBody["totalReviewer"] = document.getElementById("totalReviewer").value
            }
            fetch(`/admin/articles/${status}/[[${article.id}]]`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(requestBody)
            }).then(res => {
                if (res.ok) {
                    window.location.href = `/admin/articles?result=success`
                } else {
                    throw new Error("Something wrong")
                }

            }).catch(err => {
                alert(err)
                console.log(err)
            })
        }

    </script>
</section>

</html>