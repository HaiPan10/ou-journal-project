<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
    layout:decorate="~{layouts/layout}">


<section layout:fragment="content">
    <div th:replace="~{fragments/stepper :: stepper (step=1)}"></div>
    <form th:object="${article}" th:action="@{'/submit/step1'}" method="post">
        <div class="space-y-6 flex flex-col justify-center">
            <div class="bg-white rounded-lg px-10 py-6 xs:p-0 mx-auto w-full md:max-w-7xl border-b border-gray-900/10 mb-12 flex flex-col justify-between">
                <div>
                    <div class="grid grid-cols-1 gap-x-6 gap-y-3">
                        <div class="col-span-full">
                            <label for="title" class="block text-sm font-medium leading-6 text-gray-900">Tiêu đề</label>
                            <input id="title" name="title" type="text" th:field="*{title}"
                                class="border border-gray-300 focus:border-main/50 focus:ring-4 focus:ring-main/25 focus:outline-none rounded-md px-3 py-2 mt-1 mb-5 w-full" />
                        </div>
    
                        <div class="col-span-full">
                            <label for="description" class="block text-sm font-medium leading-6 text-gray-900">Mô tả</label>
                            <textarea id="description" name="description" rows="6" th:field="*{abstracts}"
                                class="border border-gray-300 focus:border-main/50 focus:ring-4 focus:ring-main/25 focus:outline-none rounded-md px-4 py-2 mt-1 mb-5 w-full"></textarea>
                        </div>
    
                        <div class="col-span-full">
                            <label for="keyword-input" class="block text-sm font-medium leading-6 text-gray-900">Từ
                                khóa</label>
                            <div
                                class="overflow-x-auto flex bg-white items-center border border-gray-300 hover:border-main/50 hover:ring-4 hover:ring-main/25 rounded-md mt-1 mb-5 w-full">
                                <div id="keywords-box" class="rounded-l-md h-fit flex items-center w-fit bg-white">
                                </div>
                                <div class="hidden p-0 m-0" id="last-child"></div>
                                <input id="keyword-input" style="min-width: 100px" name="keyword-input" type="text"
                                    class="grow border-0 focus:border-transparent focus:ring-0 focus:outline-none rounded-r-md px-3 py-2 w-full" />
                            </div>
    
                            <input id="keyword" name="keyword" type="text" class="hidden" th:field="*{keywords}" />
                        </div>
    
                        
                    </div>
                </div>
                
                <div class="mt-6 flex items-center justify-end gap-x-6">
                    <!-- <button type="button" class="text-sm font-semibold leading-6 text-gray-900">Trở về</button> -->
                    <button type="button" id="btnSubmit" onclick="submitForm()"
                        class="rounded-md bg-main px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-main/50 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-main/25">Tiếp
                        tục</button>
                </div>
            </div>
        </div>

    </form>
    <script>
        const kwInput = document.querySelector("#keyword-input")
        const kw = document.querySelector("#keyword")
        const kwBox = document.querySelector("#keywords-box")

        function submitForm() {
            document.querySelector("form").submit();
        }

        function removeKeyword(obj) {
            let rmElement = document.querySelector(`${obj.getAttribute("data-dismiss-target")}`)
            let kwInner = rmElement.querySelector(".kw");
            const value = kwInner.innerHTML.trim();
            let kws = kw.value.split(" ");
            kws = kws.filter(word => word !== value);
            kw.value = kws.join(' ');
            rmElement.remove();

        }

        function insertKeywordBox(elementHTML) {
            kwBox.insertAdjacentHTML('beforeend', elementHTML);
        }

        function isExisted(value) {
            if (!kw.value) return false
            const currentKeywords = kw.value.split(" ");
            for (let i = 0; i < currentKeywords.length; i++)
                if (value == currentKeywords[i])
                    return true;
            return false;
        }

        function handleKeyUp(event) {
            if (event.key == ' ' || event.code === "Space" || event.key === 'Enter') {
                let value = event.target.value.toLowerCase().trim();
                event.target.value = ""
                if (value && isExisted(value) == false) {
                    let newKwHTML = ` <div id="kw-${value}" class="kw-box" role="alert">
                        <div class="kw text-sm font-medium whitespace-nowrap">
                            ${value}
                        </div>
                          <button id="btn-remove-kw-${value}" onClick="removeKeyword(this)" type="button" class="text-main focus:ring-0 p-1 inline-flex items-center justify-center h-3 w-3" data-dismiss-target="#kw-${value}" aria-label="Close">
                            <span class="material-symbols-rounded text-sm">
                                close
                            </span>
                        </button>
                      </div>`
                    insertKeywordBox(newKwHTML);
                    kw.value += " " + value;
                }
            } else if (!event.target.value && event.key === 'Backspace') {
                const keywords = document.querySelectorAll(".kw");
                const lastKw = keywords[keywords.length - 1]
                const value = lastKw.innerHTML.trim();
                const del = document.querySelector(`#btn-remove-kw-${value}`)
                removeKeyword(del);
                event.target.value = value.slice(0, value.length);
            }
        }

        kwInput.addEventListener("keyup", handleKeyUp)

        document.addEventListener('DOMContentLoaded', function () {
            if (kw.value) {
                let kws = kw.value.split(" ");
                kws.forEach(k => {
                    if (k.trim()) {
                        let newKwHTML = ` <div id="kw-${k}" class="kw-box" role="alert">
                            <div class="kw text-sm font-medium whitespace-nowrap">
                                ${k}
                            </div>
                              <button id="btn-remove-kw-${k}" onClick="removeKeyword(this)" type="button" class="text-main focus:ring-0 p-1 inline-flex items-center justify-center h-3 w-3" data-dismiss-target="#kw-${k}" aria-label="Close">
                                <span class="material-symbols-rounded text-sm">
                                    close
                                </span>
                            </button>
                          </div>`
                        insertKeywordBox(newKwHTML);
                    }
                    
                });
            }
        });
    </script>
</section>

</html>